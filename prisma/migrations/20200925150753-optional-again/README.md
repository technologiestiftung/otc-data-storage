# Migration `20200925150753-optional-again`

This migration has been generated by fabianmoronzirfas at 9/25/2020, 5:07:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Counter" ALTER COLUMN "recordingId" DROP NOT NULL,
ALTER COLUMN "detectionTypeId" DROP NOT NULL

ALTER TABLE "public"."Detection" ALTER COLUMN "counterId" DROP NOT NULL,
ALTER COLUMN "detectionTypeId" DROP NOT NULL

ALTER TABLE "public"."LightningCondition" ALTER COLUMN "cameraId" DROP NOT NULL

ALTER TABLE "public"."Recording" ALTER COLUMN "cameraId" DROP NOT NULL

ALTER TABLE "public"."Trajectory" ALTER COLUMN "cameraId" DROP NOT NULL,
ALTER COLUMN "detectionTypeId" DROP NOT NULL

ALTER TABLE "public"."Weather" ALTER COLUMN "cameraId" DROP NOT NULL
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200925120823-rename-fieelds..20200925150753-optional-again
--- datamodel.dml
+++ datamodel.dml
@@ -2,14 +2,14 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 // datasource db {
 //   provider = "sqlite"
-//   url = "***"
+//   url = "***"
 // }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,9 +21,9 @@
 model Camera {
   id                   Int                  @default(autoincrement()) @id
   createdAt            DateTime             @default(now())
-  active               Boolean
+  active               Boolean // deprecated
   name                 String
   location             String
   timezone             Int
   transformationMatrix String?
@@ -50,10 +50,12 @@
   recordingStart DateTime
   recordingEnd   DateTime
   counters       Counter[]
-  camera   Camera @relation(fields: [cameraId], references: [id])
-  cameraId Int
+  // camera   Camera @relation(fields: [cameraId], references: [id])
+  // cameraId Int
+  Camera   Camera? @relation(fields: [cameraId], references: [id])
+  cameraId Int?
 }
 // Counter should be equivalent to Counter
 // https://opendatacam.github.io/opendatacam/apidoc/#api-Counter
@@ -84,31 +86,39 @@
   // - left
   // - right
   direction       String
   detections      Detection[]
-  recording       Recording     @relation(fields: [recordingId], references: [id])
-  recordingId     Int
-  detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
-  detectionTypeId Int
+  // recording       Recording     @relation(fields: [recordingId], references: [id])
+  // recordingId     Int
+  // detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
+  // detectionTypeId Int
+  Recording       Recording?     @relation(fields: [recordingId], references: [id])
+  recordingId     Int?
+  DetectionType   DetectionType? @relation(fields: [detectionTypeId], references: [id])
+  detectionTypeId Int?
 }
 // is there also a detection object which holds all the objects
 // of every frame detected?
 // https://opendatacam.github.io/opendatacam/apidoc/#api-Recording-Counter_data
 model Detection {
-  id              Int           @default(autoincrement()) @id
-  createdAt       DateTime      @default(now())
+  id              Int            @default(autoincrement()) @id
+  createdAt       DateTime       @default(now())
   detectedAt      DateTime
-  counter         Counter       @relation(fields: [counterId], references: [id])
-  counterId       Int
-  detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
-  detectionTypeId Int
+  // counter         Counter       @relation(fields: [counterId], references: [id])
+  // counterId       Int
+  // detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
+  // detectionTypeId Int
   confidence      Int
   // x               Float
   // y               Float
   // could have a relation to the trajectories
-  trajectory      Trajectory?   @relation(fields: [trajectoryId], references: [id])
+  trajectory      Trajectory?    @relation(fields: [trajectoryId], references: [id])
   trajectoryId    Int?
+  Counter         Counter?       @relation(fields: [counterId], references: [id])
+  counterId       Int?
+  DetectionType   DetectionType? @relation(fields: [detectionTypeId], references: [id])
+  detectionTypeId Int?
 }
 model DetectionType {
   id           Int          @default(autoincrement()) @id
@@ -124,27 +134,31 @@
 // https://opendatacam.github.io/opendatacam/apidoc/#api-Recording-Tracker_data
 //
 model Trajectory {
   id         Int    @default(autoincrement()) @id
-  camera     Camera @relation(fields: [cameraId], references: [id])
-  cameraId   Int
+  // camera     Camera @relation(fields: [cameraId], references: [id])
+  // cameraId   Int
   // Geometry(LineStringM, CUSTOM_ID)
   trajectory String
   // Geometry(LineStringM, 4326)
-  geom            String
-  detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
-  detectionTypeId Int
-  start           DateTime
-  end             DateTime
-  detections      Detection[]
+  geom       String
+  // detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
+  // detectionTypeId Int
+  start      DateTime
+  end        DateTime
+  detections Detection[]
+  DetectionType   DetectionType? @relation(fields: [detectionTypeId], references: [id])
+  detectionTypeId Int?
+  Camera          Camera?        @relation(fields: [cameraId], references: [id])
+  cameraId        Int?
 }
 model Weather {
   id            Int      @default(autoincrement()) @id
-  camera        Camera   @relation(fields: [cameraId], references: [id])
-  cameraId      Int
+  // camera        Camera   @relation(fields: [cameraId], references: [id])
+  // cameraId      Int
   createdAt     DateTime @default(now())
   recordedAt    DateTime
   humidity      Float?
   pressure      Float?
@@ -152,19 +166,23 @@
   rain          Float?
   temperature   Float?
   wind          Float?
   windDirection Float?
+  Camera        Camera?  @relation(fields: [cameraId], references: [id])
+  cameraId      Int?
 }
 // could also be some sensordata taken from the
 // enviro plus
 model LightningCondition {
   id         Int      @default(autoincrement()) @id
-  camera     Camera   @relation(fields: [cameraId], references: [id])
-  cameraId   Int
+  // camera     Camera   @relation(fields: [cameraId], references: [id])
+  // cameraId   Int
   createdAt  DateTime @default(now())
   recordedAt DateTime
   value      Float
+  Camera     Camera?  @relation(fields: [cameraId], references: [id])
+  cameraId   Int?
 }
 model User {
   id       Int     @id @default(autoincrement())
```
