# Migration `20201103173148-cleanup`

This migration has been generated by fabianmoronzirfas at 11/3/2020, 6:31:48 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;
CREATE TABLE "new_Camera" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "name" TEXT NOT NULL,
    "location" TEXT NOT NULL,
    "timezone" INTEGER NOT NULL,
    "transformationMatrix" TEXT,
    "owner" TEXT,
    "software" TEXT,
    "softwareHistory" TEXT,
    "hardware" TEXT,
    "geom" TEXT,
    "angle" TEXT
);
INSERT INTO "new_Camera" ("id", "createdAt", "name", "location", "timezone", "transformationMatrix", "owner", "software", "softwareHistory", "hardware", "geom", "angle") SELECT "id", "createdAt", "name", "location", "timezone", "transformationMatrix", "owner", "software", "softwareHistory", "hardware", "geom", "angle" FROM "Camera";
DROP TABLE "Camera";
ALTER TABLE "new_Camera" RENAME TO "Camera";
PRAGMA foreign_key_check;
PRAGMA foreign_keys=ON

CREATE UNIQUE INDEX "DetectionType.label_unique" ON "DetectionType"("label")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200925151657-lowercase..20201103173148-cleanup
--- datamodel.dml
+++ datamodel.dml
@@ -1,17 +1,17 @@
 // This is your Prisma schema file,
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
+datasource db {
+  provider = "sqlite"
+  url = "***"
+}
+
 // datasource db {
-//   provider = "sqlite"
-//   url = "***"
+//   provider = "postgresql"
+//   url = "***"
 // }
-datasource db {
-  provider = "postgresql"
-  url = "***"
-}
-
 generator client {
   provider = "prisma-client-js"
 }
@@ -19,11 +19,11 @@
 //   provider = "prisma-dbml-generator"
 // }
 model Camera {
-  id                   Int                  @default(autoincrement()) @id
+  id                   Int                  @id @default(autoincrement())
   createdAt            DateTime             @default(now())
-  active               Boolean // deprecated
+  // active               Boolean // deprecated
   name                 String
   location             String
   timezone             Int
   transformationMatrix String?
@@ -44,30 +44,23 @@
   recordings           Recording[]
 }
 model Recording {
-  id             Int       @default(autoincrement()) @id
+  id             Int       @id @default(autoincrement())
   createdAt      DateTime  @default(now())
   recordingStart DateTime
   recordingEnd   DateTime
   counters       Counter[]
-
-  // camera   Camera @relation(fields: [cameraId], references: [id])
-  // cameraId Int
-  camera   Camera? @relation(fields: [cameraId], references: [id])
-  cameraId Int?
+  camera         Camera?   @relation(fields: [cameraId], references: [id])
+  cameraId       Int?
 }
 // Counter should be equivalent to Counter
 // https://opendatacam.github.io/opendatacam/apidoc/#api-Counter
 // curl "http://192.168.1.210:8080/counter/areas"
 model Counter {
-  id        Int      @default(autoincrement()) @id
+  id        Int      @id @default(autoincrement())
   createdAt DateTime @default(now())
-  // active    Boolean
-  // camera    Camera   @relation(fields: [cameraId], references: [id])
-  // cameraId  Int
-  // manually
   street    String
   // manually
   streetId  String // or Int?
   x1        Float
@@ -86,12 +79,8 @@
   // - left
   // - right
   direction       String
   detections      Detection[]
-  // recording       Recording     @relation(fields: [recordingId], references: [id])
-  // recordingId     Int
-  // detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
-  // detectionTypeId Int
   recording       Recording?     @relation(fields: [recordingId], references: [id])
   recordingId     Int?
   detectionType   DetectionType? @relation(fields: [detectionTypeId], references: [id])
   detectionTypeId Int?
@@ -100,18 +89,12 @@
 // is there also a detection object which holds all the objects
 // of every frame detected?
 // https://opendatacam.github.io/opendatacam/apidoc/#api-Recording-Counter_data
 model Detection {
-  id              Int            @default(autoincrement()) @id
+  id              Int            @id @default(autoincrement())
   createdAt       DateTime       @default(now())
   detectedAt      DateTime
-  // counter         Counter       @relation(fields: [counterId], references: [id])
-  // counterId       Int
-  // detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
-  // detectionTypeId Int
   confidence      Int
-  // x               Float
-  // y               Float
   // could have a relation to the trajectories
   trajectory      Trajectory?    @relation(fields: [trajectoryId], references: [id])
   trajectoryId    Int?
   counter         Counter?       @relation(fields: [counterId], references: [id])
@@ -120,10 +103,10 @@
   detectionTypeId Int?
 }
 model DetectionType {
-  id           Int          @default(autoincrement()) @id
-  label        String
+  id           Int          @id @default(autoincrement())
+  label        String       @unique
   description  String?
   counters     Counter[]
   trajectories Trajectory[]
   detections   Detection[]
@@ -133,18 +116,15 @@
 // replace by the track object
 // https://opendatacam.github.io/opendatacam/apidoc/#api-Recording-Tracker_data
 //
 model Trajectory {
-  id         Int    @default(autoincrement()) @id
-  // camera     Camera @relation(fields: [cameraId], references: [id])
-  // cameraId   Int
+  id Int @id @default(autoincrement())
+
   // Geometry(LineStringM, CUSTOM_ID)
   trajectory String
   // Geometry(LineStringM, 4326)
   geom       String
-  // detectionType   DetectionType @relation(fields: [detectionTypeId], references: [id])
-  // detectionTypeId Int
   start      DateTime
   end        DateTime
   detections Detection[]
@@ -154,11 +134,9 @@
   cameraId        Int?
 }
 model Weather {
-  id            Int      @default(autoincrement()) @id
-  // camera        Camera   @relation(fields: [cameraId], references: [id])
-  // cameraId      Int
+  id            Int      @id @default(autoincrement())
   createdAt     DateTime @default(now())
   recordedAt    DateTime
   humidity      Float?
   pressure      Float?
@@ -173,11 +151,9 @@
 // could also be some sensordata taken from the
 // enviro plus
 model LightningCondition {
-  id         Int      @default(autoincrement()) @id
-  // camera     Camera   @relation(fields: [cameraId], references: [id])
-  // cameraId   Int
+  id         Int      @id @default(autoincrement())
   createdAt  DateTime @default(now())
   recordedAt DateTime
   value      Float
   camera     Camera?  @relation(fields: [cameraId], references: [id])
```
