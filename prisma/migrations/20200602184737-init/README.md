# Migration `20200602184737-init`

This migration has been generated by fabianmoronzirfas at 6/2/2020, 6:47:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."Camera" (
"active" BOOLEAN NOT NULL  ,"angle" TEXT   ,"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"geom" TEXT   ,"hardware" TEXT   ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"loction" TEXT NOT NULL  ,"name" TEXT NOT NULL  ,"owner" TEXT   ,"software" TEXT   ,"softwareHistory" TEXT   ,"timezone" INTEGER NOT NULL  ,"transformationMatrix" TEXT   )

CREATE TABLE "quaint"."Counter" (
"active" BOOLEAN NOT NULL  ,"cameraId" INTEGER NOT NULL  ,"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"direction" TEXT NOT NULL  ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"line" TEXT NOT NULL  ,"street" TEXT NOT NULL  ,"streetId" TEXT NOT NULL  ,"x1" REAL NOT NULL  ,"x2" REAL NOT NULL  ,"y1" REAL NOT NULL  ,"y2" REAL NOT NULL  ,FOREIGN KEY ("cameraId") REFERENCES "Camera"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."Detection" (
"accuracy" REAL NOT NULL  ,"counterId" INTEGER NOT NULL  ,"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"detectedAt" DATE NOT NULL  ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"typeId" INTEGER NOT NULL  ,"x" REAL NOT NULL  ,"y" REAL NOT NULL  ,FOREIGN KEY ("counterId") REFERENCES "Counter"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("typeId") REFERENCES "DetectionType"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."DetectionType" (
"description" TEXT   ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"label" TEXT NOT NULL  )

CREATE TABLE "quaint"."Trajectory" (
"cameraId" INTEGER NOT NULL  ,"end" DATE NOT NULL  ,"geom" TEXT NOT NULL  ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"start" DATE NOT NULL  ,"trajectory" TEXT NOT NULL  ,"typeId" INTEGER NOT NULL  ,FOREIGN KEY ("cameraId") REFERENCES "Camera"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("typeId") REFERENCES "DetectionType"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."Weather" (
"cameraId" INTEGER NOT NULL  ,"cloudCoverage" REAL   ,"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"humidity" REAL   ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"pressure" REAL   ,"rain" REAL   ,"recordedAt" DATE NOT NULL  ,"temperature" REAL   ,"wind" REAL   ,"windDirection" REAL   ,FOREIGN KEY ("cameraId") REFERENCES "Camera"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."LightningCondition" (
"cameraId" INTEGER NOT NULL  ,"createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,"recordedAt" DATE NOT NULL  ,"value" REAL NOT NULL  ,FOREIGN KEY ("cameraId") REFERENCES "Camera"("id") ON DELETE CASCADE ON UPDATE CASCADE)

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200602184737-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,114 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "sqlite"
+  url      = "file:./dev.db"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Camera {
+  id                   Int                  @default(autoincrement()) @id
+  createdAt            DateTime             @default(now())
+  active               Boolean
+  name                 String
+  loction              String
+  transformationMatrix String?
+  owner                String?
+  timezone             Int
+  software             String?
+  softwareHistory      String?
+  hardware             String?
+  // Geometry(Point, 4326)
+  geom                 String?
+  // Geometry(Line, 4326)
+  angle                String?
+  Counter              Counter[]
+  Trajectory           Trajectory[]
+  Weather              Weather[]
+  LightningCondition   LightningCondition[]
+}
+
+model Counter {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  active    Boolean
+  camera    Camera   @relation(fields: [cameraId], references: [id])
+  cameraId  Int
+  street    String
+  streetId  String // or Int?
+  x1        Float
+  y1        Float
+  x2        Float
+  y2        Float
+
+
+  // Geometry(Line, 4326)
+  line      String
+  // Geometry(Line, 4326)
+  direction String
+  Detection Detection[]
+}
+
+model Detection {
+  id         Int           @default(autoincrement()) @id
+  createdAt  DateTime      @default(now())
+  detectedAt DateTime
+  counter    Counter       @relation(fields: [counterId], references: [id])
+  counterId  Int
+  type       DetectionType @relation(fields: [typeId], references: [id])
+  typeId     Int
+  accuracy   Float
+  x          Float
+  y          Float
+}
+
+model DetectionType {
+  id          Int          @default(autoincrement()) @id
+  label       String
+  description String?
+  Detection   Detection[]
+  Trajectory  Trajectory[]
+}
+
+model Trajectory {
+  id         Int    @default(autoincrement()) @id
+  camera     Camera @relation(fields: [cameraId], references: [id])
+  cameraId   Int
+  // Geometry(LineStringM, CUSTOM_ID)
+  trajectory String
+
+  // Geometry(LineStringM, 4326)
+  geom   String
+  type   DetectionType @relation(fields: [typeId], references: [id])
+  typeId Int
+  start  DateTime
+  end    DateTime
+}
+
+model Weather {
+  id            Int      @default(autoincrement()) @id
+  camera        Camera   @relation(fields: [cameraId], references: [id])
+  cameraId      Int
+  createdAt     DateTime @default(now())
+  recordedAt    DateTime
+  humidity      Float?
+  pressure      Float?
+  cloudCoverage Float?
+  rain          Float?
+  temperature   Float?
+  wind          Float?
+  windDirection Float?
+}
+
+model LightningCondition {
+  id         Int      @default(autoincrement()) @id
+  camera     Camera   @relation(fields: [cameraId], references: [id])
+  cameraId   Int
+  createdAt  DateTime @default(now())
+  recordedAt DateTime
+  value      Float
+}
```
